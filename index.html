<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/TextPlugin.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-light: #f1f5f9; --text-light: #1e293b; --card-light: rgba(255,255,255,0.7);
            --bg-dark: #020617; --text-dark: #e2e8f0; --card-dark: rgba(15,23,42,0.7);
            --accent-start: #4f46e5; --accent-end: #0ea5e9; --shadow-color: 224,71%,4%;
            --glow-color: rgba(79,70,229,0.4);
        }
        html.dark { --bg: var(--bg-dark); --text-primary: var(--text-dark); --text-secondary: #94a3b8; --card-bg: var(--card-dark); --shadow-color: 224,71%,10%; }
        html.light { --bg: var(--bg-light); --text-primary: var(--text-light); --text-secondary: #475569; --card-bg: var(--card-light); --shadow-color: 224,71%,50%; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Space Grotesk', sans-serif;
            background-color: var(--bg);
            color: var(--text-primary);
            transition: background-color 0.5s, color 0.5s;
        }
        /* Custom shaded office background */
        #animated-bg {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh; z-index: -1;
            background-image: url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=2070&q=80');
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center center;
            opacity: 0.13;
            filter: grayscale(80%) blur(4px);
            transition: opacity 0.5s;
        }
        html.light #animated-bg {
            opacity: 0.07;
            filter: grayscale(60%) blur(3px);
        }
        .card {
            background: var(--card-bg); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-radius: 1.25rem;
            box-shadow: 0 4px 6px -1px hsla(var(--shadow-color),0.05),0 2px 4px -2px hsla(var(--shadow-color), 0.05);
            border: 1px solid rgba(127,127,127,0.1);
            transition: all 0.3s cubic-bezier(0.25,0.8,0.25,1);
        }
        .interactive-element:hover { transform: translateY(-8px); box-shadow: 0px 20px 25px -5px hsla(var(--shadow-color),0.10),0 8px 10px -6px hsla(var(--shadow-color),0.1),0 0 25px var(--glow-color);}
        .nav-link::after { content: ''; position: absolute; width: 0; height: 2px; bottom: -4px; left: 50%; transform:translateX(-50%); background-color: var(--accent-start); transition: width 0.3s;}
        .nav-link:hover::after { width:100%;}
        .section-heading { color: var(--text-primary); }
        .gradient-text { background-image: linear-gradient(90deg, var(--accent-start), var(--accent-end)); -webkit-background-clip: text; color: transparent; }
        .loader { border: 4px solid rgba(127,127,127,0.2); border-left-color: var(--accent-start); border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite;}
        @keyframes spin { to { transform: rotate(3deg);} }
        .tech-badge {
            background: linear-gradient(90deg, hsla(243,85%,66%,0.1), hsla(199,85%,59%,0.1));
            padding: 0.25rem 0.75rem; border-radius: 9999px;
            font-size: 0.875rem; font-weight: 500;
            border: 1px solid hsla(243,85%,66%,0.2);
            color: var(--text-primary);
        }
        html.light .tech-badge {
            background: linear-gradient(90deg, hsla(243,85%,66%,0.15), hsla(199,85%,59%,0.15));
        }
        .q-value-bar .tooltip { visibility: hidden; opacity: 0; transition: all 0.2s ease-in-out; transform: translateY(10px);}
        .q-value-bar:hover .tooltip { visibility: visible; opacity: 1; transform: translateY(0);}
        ::selection { background: var(--accent-end); color: white;}
        .timeline::before { content: ''; position: absolute; left: .5rem; top: .5rem; bottom: .5rem; width: 2px; background-color: rgba(127,127,127,0.2); }
        .timeline-item { position: relative; padding-left: 2.5rem; }
        .timeline-dot { position: absolute; left: .5rem; top: 0.25rem; transform: translateX(-50%); width: 1rem; height: 1rem; border-radius: 99px; background-color: var(--accent-start); border: 2px solid var(--bg);}
        .separator { height: 10rem; position: relative; background: linear-gradient(to bottom, transparent, var(--bg) 50%, var(--bg));}
        .separator-heading { transform: translate(-50%, 50%);}
        
        /* New animated button styles */
        .animated-card-button {
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }
        .animated-card-button::after {
            content: '';
            position: absolute;
            width: 0;
            height: 4px;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(90deg, var(--accent-start), var(--accent-end));
            transition: width 0.4s ease-out;
            border-radius: 2px;
        }
        .animated-card-button:hover::after {
            width: 80%;
        }
    </style>
</head>
<body class="transition-colors duration-500">
    <div id="animated-bg"></div>
    <!-- Header & Navigation -->
    <header class="sticky top-0 z-50 card !rounded-none border-b">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-16">
            <a href="#home" class="text-2xl font-bold gradient-text">Portfolio</a>
            <div class="hidden md:flex items-center space-x-2">
                <a href="#about" class="nav-link px-3 py-2 text-sm font-medium">About</a>
                <a href="#projects" class="nav-link px-3 py-2 text-sm font-medium">Projects</a>
                <a href="#research" class="nav-link px-3 py-2 text-sm font-medium">Research</a>
                <a href="#experience" class="nav-link px-3 py-2 text-sm font-medium">Experience</a>
                <a href="#contact" class="nav-link px-3 py-2 text-sm font-medium">Contact</a>
                <a href="#ai-playground" class="nav-link px-3 py-2 font-bold text-cyan-400">AI Playground</a>
            </div>
            <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-500/10 transition-colors"><svg id="theme-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"></svg></button>
        </nav>
    </header>
    <main class="max-w-7xl mx-auto p-4 md:p-8 space-y-24">
        <!-- Hero Section -->
        <section id="home" class="text-center py-24">
            <h1 class="text-5xl md:text-7xl font-black leading-tight">Vinay Kumar</h1>
            <div class="text-3xl md:text-5xl font-bold mt-2 h-16"><span id="role-text" class="gradient-text"></span></div>
            <p class="mt-4 text-lg text-slate-500 dark:text-slate-400 max-w-3xl mx-auto">An AI/ML Engineer and Researcher passionate about building intelligent systems that solve real-world problems.</p>
            <div class="mt-8 flex justify-center gap-4">
                <a href="#projects" class="px-6 py-3 rounded-full bg-gradient-to-r from-indigo-600 to-sky-500 text-white font-semibold interactive-element">Explore My Work</a>
                <a href="#contact" class="px-6 py-3 rounded-full bg-slate-500/20 font-semibold interactive-element">Contact Me</a>
            </div>
        </section>
        <!-- About Section -->
        <section id="about" class="card p-8 md:p-12 animated-card-button global-clickable">
            <h2 class="section-heading text-3xl font-bold mb-8">About Me</h2>
            <p class="mb-8 text-lg">An AI/ML Engineer specializing in deep learning, reinforcement learning, and adaptive systems. Passionate about developing intelligent, context-aware applications that enhance human-computer interaction.</p>
            <h3 class="text-2xl font-bold mb-6">Tech Stack</h3>
            <div class="flex flex-wrap gap-x-3 gap-y-2 justify-center">
                <span class="tech-badge">Python</span><span class="tech-badge">TensorFlow</span><span class="tech-badge">PyTorch</span>
                <span class="tech-badge">Scikit-learn</span><span class="tech-badge">OpenCV</span><span class="tech-badge">NLP</span>
                <span class="tech-badge">Reinforcement Learning</span><span class="tech-badge">Data Visualization</span>
            </div>
        </section>
        <!-- Projects Section -->
        <section id="projects" class="space-y-8">
            <h2 class="section-heading text-3xl font-bold text-center">Featured Projects</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="card p-6 interactive-element animated-card-button global-clickable"><h3 class="font-bold text-xl">NeuroVision</h3><p class="text-sm text-slate-500 dark:text-slate-400">Reinforcement Learning-based system for adaptive UI personalization and attention tracking.</p></div>
                <div class="card p-6 interactive-element animated-card-button global-clickable"><h3 class="font-bold text-xl">DeepHealthNet</h3><p class="text-sm text-slate-500 dark:text-slate-400">Explainable deep neural model for medical diagnosis and obesity prediction.</p></div>
                <div class="card p-6 interactive-element animated-card-button global-clickable"><h3 class="font-bold text-xl">Project Drishti X</h3><p class="text-sm text-slate-500 dark:text-slate-400">Agentic AI for public event safety and crowd anomaly detection.</p></div>
                <div class="card p-6 interactive-element animated-card-button global-clickable"><h3 class="font-bold text-xl">AICoReg</h3><p class="text-sm text-slate-500 dark:text-slate-400">AI-driven compliance and regulation prediction engine for enterprise platforms.</p></div>
            </div>
        </section>
        <!-- Research & Publications -->
        <section id="research" class="card p-8 md:p-12 animated-card-button global-clickable">
            <h2 class="section-heading text-3xl font-bold mb-8">Research & Publications</h2>
            <div class="space-y-6">
                <div class="interactive-element p-4 rounded-lg hover:bg-slate-500/10"><h3 class="font-bold text-xl">RL-Based Context-Aware UI Optimization for Adaptive Systems</h3><p class="text-sm text-slate-500 dark:text-slate-400">Springer AI Journal, 2025.</p></div>
                <div class="interactive-element p-4 rounded-lg hover:bg-slate-500/10"><h3 class="font-bold text-xl">Enhancing Obesity Prediction with Explainable AI: A DeepHealthNet-Based Comparative Study</h3><p class="text-sm text-slate-500 dark:text-slate-400">IEEE ICCoSD 2025.</p></div>
                <div class="interactive-element p-4 rounded-lg hover:bg-slate-500/10"><h3 class="font-bold text-xl">Emotion-Aware Adaptive Dashboards Using Reinforcement Learning</h3><p class="text-sm text-slate-500 dark:text-slate-400">Under Review.</p></div>
            </div>
        </section>
        <!-- Internships & Achievements -->
        <section id="experience" class="card p-8 md:p-12 animated-card-button global-clickable">
            <h2 class="section-heading text-3xl font-bold mb-8">Experience & Internships</h2>
            <div class="relative timeline">
                <div class="timeline-item mb-8"><div class="timeline-dot"></div><h3 class="font-bold">AI Research Intern ‚Äì Google DeepMind</h3><p class="text-sm text-slate-500 dark:text-slate-400">Worked on attention-based reinforcement learning for human-AI interaction modeling. Developed simulation environments to test adaptive learning agents.</p></div>
                <div class="timeline-item mb-8"><div class="timeline-dot"></div><h3 class="font-bold">Machine Learning Intern ‚Äì NVIDIA Research</h3><p class="text-sm text-slate-500 dark:text-slate-400">Contributed to optimization of real-time inference models for UI adaptability and user experience personalization.</p></div>
                <div class="timeline-item"><div class="timeline-dot"></div><h3 class="font-bold">AI Systems Engineer ‚Äì OpenAI Fellowship</h3><p class="text-sm text-slate-500 dark:text-slate-400">Designed and evaluated reward modeling pipelines for reinforcement learning from human feedback (RLHF) in interactive web environments.</p></div>
            </div>
        </section>
        <!-- Contact Section -->
        <section id="contact" class="card p-8 md:p-12 text-center animated-card-button global-clickable">
            <h2 class="section-heading text-3xl font-bold">Let's Connect</h2>
            <p class="mb-8">Open to new opportunities and collaborations.</p>
            <div class="flex justify-center gap-6">
                <a href="mailto:youremail@example.com" class="text-4xl interactive-element"><i class="fas fa-envelope"></i></a>
                <a href="#" class="text-4xl interactive-element"><i class="fab fa-linkedin"></i></a>
                <a href="#" class="text-4xl interactive-element"><i class="fab fa-github"></i></a>
            </div>
        </section>
        <div class="separator">
            <h2 class="text-center font-bold text-2xl absolute bottom-1/2 left-1/2 p-4 card separator-heading flex items-center gap-2"><span class="text-3xl">‚öôÔ∏è</span>Experimental AI Playground</h2>
        </div>
    </main>
    <!-- AI Playground Section -->
    <section id="ai-playground" class="max-w-7xl mx-auto p-4 md:p-8 space-y-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="card p-6 md:p-10 flex flex-col lg:col-span-2 relative">
                <div id="content-container" class="grid grid-cols-1 md:grid-cols-2 gap-6 flex-grow"></div>
                <div class="flex justify-center mt-12">
                    <button id="cta-button" class="text-white font-bold py-4 px-10 rounded-full text-xl transition-all duration-300 transform shadow-lg interactive-element">Loading...</button>
                </div>
                <div id="loading-overlay" class="absolute inset-0 bg-slate-800/20 backdrop-blur-sm flex-col items-center justify-center rounded-2xl hidden"><div class="loader"></div><p class="mt-4 font-semibold">Agent is learning...</p></div>
            </div>
            <aside class="w-full card p-6 md:p-8 flex flex-col lg:col-span-1 space-y-6">
                <h3 class="text-2xl font-bold text-center border-b pb-4 dark:border-slate-700 flex items-center justify-center gap-2">Agent Control Panel <span class="text-xs font-mono px-2 py-1 rounded-full bg-emerald-500/20 text-emerald-400">‚öôÔ∏è RL Mode: Active</span></h3>
                <div class="grid grid-cols-3 gap-4">
                    <div class="text-center card p-2"><p class="text-sm opacity-70">Clicks</p><p id="total-clicks" class="text-2xl font-bold">0</p></div>
                    <div class="text-center card p-2"><p class="text-sm opacity-70">Total Reward</p><p id="total-reward" class="text-2xl font-bold">0</p></div>
                    <div class="text-center card p-2"><p class="text-sm opacity-70">Last Reward</p><p id="last-reward" class="text-2xl font-bold text-indigo-500">0</p></div>
                </div>
                <div class="card p-4">
                    <p class="text-sm text-center font-semibold mb-2">Agent Insight</p><p id="ai-insight" class="text-xs text-center font-mono opacity-80 h-16 flex items-center justify-center"></p>
                </div>
                <div><p class="text-center font-semibold mb-2">Reward Trend</p><canvas id="reward-chart"></canvas></div>
                <div class="card p-4">
                    <p class="text-sm text-center font-semibold mb-2">Live Leaderboard</p>
                    <p class="text-xs text-center opacity-60 mb-2">The leaderboard shows the agent‚Äôs best-performing UI configurations.</p>
                    <div id="leaderboard" class="space-y-2 text-xs font-mono"></div>
                </div>
                <div class="flex flex-col gap-4 pt-4 border-t dark:border-slate-700">
                    <button id="bounce-button" class="w-full bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-6 rounded-full interactive-element">Simulate Leaving (-1 Reward)</button>
                    <button id="simulate-random-button" class="w-full bg-sky-500 hover:bg-sky-600 text-white font-bold py-3 px-6 rounded-full interactive-element">Simulate Random User Behavior</button>
                    <button id="reset-button" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-full interactive-element">Reset Agent Memory</button>
                </div>
            </aside>
        </div>
    </section>
    <!-- Hidden templates for RL content -->
    <div class="hidden">
        <div id="engagement-template" class="card p-6 interactive-element"><h3 class="font-bold text-xl">Engagement Panel</h3><p class="text-sm opacity-80">Designed to capture user attention and encourage interaction.</p></div>
        <div id="info-template" class="card p-6 interactive-element"><h3 class="font-bold text-xl">Information Insights</h3><p class="text-sm opacity-80">Provides key information. The agent learns if this placement is effective.</p></div>
        <div id="contact-template" class="card p-6 interactive-element"><h3 class="font-bold text-xl">Contact Block</h3><p class="text-sm opacity-80">Tests if placing a call-to-action here increases engagement.</p></div>
        <div id="projects-summary-template" class="card p-6 interactive-element"><h3 class="font-bold text-xl">Projects Summary</h3><p class="text-sm opacity-80">A compact view of key projects to catch the eye.</p></div>
        <div id="research-summary-template" class="card p-6 interactive-element"><h3 class="font-bold text-xl">Research Abstracts</h3><p class="text-sm opacity-80">Highlights from published research papers.</p></div>
        <div id="achievements-summary-template" class="card p-6 interactive-element"><h3 class="font-bold text-xl">Achievements Spotlight</h3><p class="text-sm opacity-80">Showcases top achievements and hackathon wins.</p></div>
    </div>
    
    <!-- Custom Confirmation Modal -->
    <div id="confirmation-modal" class="fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm z-50 flex items-center justify-center hidden">
        <div class="card p-8 rounded-lg max-w-sm w-full mx-4">
            <h3 class="text-xl font-bold mb-4" id="modal-title">Confirm Action</h3>
            <p class="text-slate-400 mb-6" id="modal-text">Are you sure you want to reset the agent's memory?</p>
            <div class="flex justify-end gap-4">
                <button id="modal-cancel-button" class="px-6 py-2 rounded-full bg-slate-500/20 font-semibold interactive-element">Cancel</button>
                <button id="modal-confirm-button" class="px-6 py-2 rounded-full bg-red-600 hover:bg-red-700 text-white font-semibold interactive-element">Confirm Reset</button>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            gsap.registerPlugin(TextPlugin);
            let rewardChart;
            const layoutNameMap = {
                'engagement': 'Engage', 'info': 'Info', 'contact': 'Contact', 'projects-summary': 'Projects',
                'research-summary': 'Research', 'achievements-summary': 'Achieve'
            };
            const formatLayout = (layoutArray) => layoutArray.map(key => layoutNameMap[key] || key.charAt(0).toUpperCase()).join('‚Üí');
            const themeToggle = document.getElementById('theme-toggle');
            const themeIcon = document.getElementById('theme-icon');
            const sunIcon = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>`;
            const moonIcon = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>`;
            
            const setTheme = (isDark) => {
                document.documentElement.classList.toggle('dark', isDark);
                document.documentElement.classList.toggle('light', !isDark);
                themeIcon.innerHTML = isDark ? sunIcon : moonIcon;
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                if (rewardChart) {
                    const textColor = isDark ? '#e2e8f0' : '#1e293b';
                    rewardChart.options.scales.y.ticks.color = textColor;
                    rewardChart.options.scales.x.ticks.color = textColor;
                    rewardChart.update();
                }
            };
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const savedTheme = localStorage.getItem('theme');
            
            // --- ROLE TEXT ANIMATION ---
            const roles = ["Building Intelligent Systems", "Solving Real-World Problems", "Innovating with Data", "Exploring Reinforcement Learning"];
            let roleIndex = 0;
            const roleText = document.getElementById('role-text');
            function typeRole() {
                if (!roleText) return;
                gsap.to(roleText, { duration: 2, text: {value: roles[roleIndex], padSpace: true}, ease: "none", onComplete: () => {
                    gsap.delayedCall(2, () => {
                        roleIndex = (roleIndex + 1) % roles.length;
                        typeRole();
                    });
                }});
            }
            if (roleText) typeRole();

            // --- MODAL LOGIC ---
            const confirmationModal = document.getElementById('confirmation-modal');
            const modalConfirmButton = document.getElementById('modal-confirm-button');
            const modalCancelButton = document.getElementById('modal-cancel-button');
            let resolveConfirm;

            function showConfirmationModal() {
                confirmationModal.classList.remove('hidden');
                return new Promise((resolve) => {
                    resolveConfirm = resolve;
                });
            }
            modalConfirmButton.addEventListener('click', () => {
                confirmationModal.classList.add('hidden');
                if (resolveConfirm) resolveConfirm(true);
            });
            modalCancelButton.addEventListener('click', () => {
                confirmationModal.classList.add('hidden');
                if (resolveConfirm) resolveConfirm(false);
            });

            // --- RL AGENT ---
            class QLearningAgent {
                constructor(stateSpace, actionSpace, alpha = 0.1, gamma = 0.9, epsilon = 0.2) { this.qTable = {}; this.alpha = alpha; this.gamma = gamma; this.epsilon = epsilon; this.stateSpace = stateSpace; this.actionSpace = actionSpace; this.totalClicks = 0; this.totalReward = 0; this.rewardHistory = []; this.actionHistory = []; this.actionStats = {}; this.loadData(); }
                getActionKey(action) { return `${action.color}_${action.text}_${action.layout.join('-')}`; }
                getStateActionKey(state, action) { return `${state}__${this.getActionKey(action)}`; }
                getQValue(state, action) { return this.qTable[this.getStateActionKey(state, action)] || 0.0; }
                chooseAction(state) { if (Math.random() < this.epsilon) { return this.actionSpace[Math.floor(Math.random() * this.actionSpace.length)]; } else { let bestAction = null, maxQ = -Infinity; for (const action of this.actionSpace) { const qValue = this.getQValue(state, action); if (qValue > maxQ) { maxQ = qValue; bestAction = action; } } return bestAction || this.actionSpace[Math.floor(Math.random() * this.actionSpace.length)]; } }
                updateQValue(state, action, reward) {
                    const key = this.getStateActionKey(state, action);
                    const oldQ = this.getQValue(state, action);
                    const newQ = oldQ + this.alpha * (reward + this.gamma * 0.0 - oldQ);
                    this.qTable[key] = newQ;
                    if (reward > 0) this.totalClicks++;
                    this.totalReward += reward;
                    this.rewardHistory.push(this.totalReward);
                    this.actionHistory.push(action);
                    const layoutKey = formatLayout(action.layout);
                    if(!this.actionStats[layoutKey]) this.actionStats[layoutKey] = { count: 0, totalReward: 0 };
                    this.actionStats[layoutKey].count++;
                    this.actionStats[layoutKey].totalReward += reward;
                    this.saveData();
                }
                saveData() { localStorage.setItem('rlAgentData', JSON.stringify({ qTable: this.qTable, totalClicks: this.totalClicks, totalReward: this.totalReward, rewardHistory: this.rewardHistory, actionHistory: this.actionHistory, actionStats: this.actionStats })); }
                loadData() { const data = JSON.parse(localStorage.getItem('rlAgentData')); if (data) { this.qTable = data.qTable || {}; this.totalClicks = data.totalClicks || 0; this.totalReward = data.totalReward || 0; this.rewardHistory = data.rewardHistory || []; this.actionHistory = data.actionHistory || []; this.actionStats = data.actionStats || {}; } }
                reset() { this.qTable = {}; this.totalClicks = 0; this.totalReward = 0; this.rewardHistory = []; this.actionHistory = []; this.actionStats = {}; this.saveData(); }
                getStats() { return { total_clicks: this.totalClicks, total_reward: this.totalReward, q_values: this.qTable, reward_history: this.rewardHistory, action_history: this.actionHistory, action_stats: this.actionStats }; }
            }
            const layouts = [
                ['engagement', 'info', 'contact', 'projects-summary', 'research-summary', 'achievements-summary'],
                ['projects-summary', 'research-summary', 'achievements-summary', 'engagement', 'info', 'contact'],
                ['info', 'projects-summary', 'engagement', 'research-summary', 'achievements-summary', 'contact'],
                ['contact', 'achievements-summary', 'research-summary', 'projects-summary', 'info', 'engagement']
            ];
            const ACTION_SPACE = [];
            const colors = ["bg-indigo-600", "bg-emerald-500", "bg-sky-500"];
            const texts = ["Explore Now", "View Details", "Learn More"];
            for (const c of colors) for (const t of texts) for (const l of layouts) ACTION_SPACE.push({ color: c, text: t, layout: l });
            let currentAction = null;
            const agent = new QLearningAgent(['user-session'], ACTION_SPACE);
            const dom = {
                ctaButton: document.getElementById('cta-button'), contentContainer: document.getElementById('content-container'),
                totalClicks: document.getElementById('total-clicks'), totalReward: document.getElementById('total-reward'),
                lastReward: document.getElementById('last-reward'), aiInsight: document.getElementById('ai-insight'),
                leaderboard: document.getElementById('leaderboard'),
                loadingOverlay: document.getElementById('loading-overlay'),
                sections: {
                    engagement: document.getElementById('engagement-template'), info: document.getElementById('info-template'), contact: document.getElementById('contact-template'),
                    'projects-summary': document.getElementById('projects-summary-template'), 'research-summary': document.getElementById('research-summary-template'), 'achievements-summary': document.getElementById('achievements-summary-template'),
                }
            };
            // --- CHART ---
            function setupChart() {
                const ctx = document.getElementById('reward-chart').getContext('2d');
                const isDark = document.documentElement.classList.contains('dark');
                const textColor = isDark ? '#e2e8f0' : '#1e293b';
                rewardChart = new Chart(ctx, {
                    type: 'line',
                    data: { labels: [], datasets: [{ label: 'Cumulative Reward', data: [], borderColor: 'var(--accent-start)', backgroundColor: 'rgba(79, 70, 229, 0.2)', fill: true, tension: 0.4 }] },
                    options: {
                        scales: { x: { display: false }, y: { beginAtZero: false, ticks: { color: textColor } } },
                        plugins: { legend: { display: false },
                            tooltip: {
                                enabled: true, mode: 'index', intersect: false,
                                callbacks: {
                                    label: function(context) {
                                        let label = `Reward: ${context.parsed.y}`;
                                        const action = agent.getStats().action_history[context.dataIndex];
                                        if (action) { label += ` | Layout: ${formatLayout(action.layout)}`; }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
            }
            function updateUI(action) {
                dom.ctaButton.className = `text-white font-bold py-4 px-10 rounded-full text-xl transition-all duration-300 transform shadow-lg interactive-element ${action.color} hover:${action.color.replace('600', '500')}`;
                dom.ctaButton.textContent = action.text;
                dom.contentContainer.innerHTML = '';
                action.layout.forEach(key => dom.contentContainer.appendChild(dom.sections[key].cloneNode(true)));
            }
            function updateDashboard() {
                const stats = agent.getStats();
                dom.totalClicks.textContent = stats.total_clicks;
                dom.totalReward.textContent = stats.total_reward;
                if (rewardChart) {
                    rewardChart.data.labels = stats.reward_history.map((_, i) => i + 1);
                    rewardChart.data.datasets[0].data = stats.reward_history;
                    rewardChart.update();
                }
                updateLeaderboard(stats.action_stats);
            }
            function updateLeaderboard(actionStats) {
                dom.leaderboard.innerHTML = '';
                if(Object.keys(actionStats).length === 0) {
                    dom.leaderboard.innerHTML = `<p class="opacity-50 text-center">No sessions recorded yet.</p>`;
                    return;
                }
                const sortedLayouts = Object.entries(actionStats).map(([layout, stats]) => ({ layout, avgReward: stats.totalReward / stats.count })).sort((a, b) => b.avgReward - a.avgReward).slice(0, 3);
                const medals = ['ü•á', 'ü•à', 'ü•â'];
                sortedLayouts.forEach((item, index) => {
                    const div = document.createElement('div');
                    div.className = "flex items-center";
                    div.innerHTML = `<span class="mr-2">${medals[index]}</span><span class="flex-grow">${item.layout}</span> <span class="${item.avgReward > 0 ? 'text-green-400' : 'text-red-400'} font-bold">${item.avgReward.toFixed(2)}</span>`;
                    dom.leaderboard.appendChild(div);
                });
            }
            function showLearning(reward, isReset = false) {
                dom.loadingOverlay.classList.remove('hidden');
                dom.loadingOverlay.classList.add('flex');
                let insight = "";
                if(isReset) {
                    insight = "Agent memory successfully reset.";
                    dom.lastReward.textContent = 0;
                    dom.aiInsight.textContent = '';
                } else {
                    dom.lastReward.textContent = reward;
                    dom.lastReward.className = `text-2xl font-bold ${reward > 0 ? 'text-green-400' : 'text-red-400'}`;
                    const layoutStr = formatLayout(currentAction.layout);
                    insight = reward > 0 ? `‚úÖ Positive interaction recorded. Engagement increased!` : `‚ö†Ô∏è Negative interaction recorded. The agent will adjust.`;
                }
                gsap.fromTo(dom.aiInsight, {opacity: 0, y: 10}, {duration: 0.5, text: {value: insight}, ease: "power2.out", opacity: 1, y: 0});
                setTimeout(() => {
                    dom.loadingOverlay.classList.add('hidden');
                    dom.loadingOverlay.classList.remove('flex');
                }, 1000);
            }
            // --- CONTROL FLOW ---
            function startNewSession() {
                currentAction = agent.chooseAction('user-session');
                updateUI(currentAction);
                updateDashboard();
            }
            function handleReward(reward) {
                if (!currentAction) return;
                showLearning(reward);
                agent.updateQValue('user-session', currentAction, reward);
                setTimeout(startNewSession, 1000);
            }
            let simulationInterval = null;
            function simulateRandomBehavior() {
                const randomButton = document.getElementById('simulate-random-button');
                if (simulationInterval) {
                    clearInterval(simulationInterval);
                    simulationInterval = null;
                    randomButton.textContent = "Simulate Random User Behavior";
                    randomButton.classList.remove('bg-red-500', 'hover:bg-red-600');
                    randomButton.classList.add('bg-sky-500', 'hover:bg-sky-600');
                } else {
                    randomButton.textContent = "Stop Simulation";
                    randomButton.classList.add('bg-red-500', 'hover:bg-red-600');
                    randomButton.classList.remove('bg-sky-500', 'hover:bg-sky-600');
                    simulationInterval = setInterval(() => {
                        const rewards = [10, -1, -1, 10, 10];
                        handleReward(rewards[Math.floor(Math.random() * rewards.length)]);
                    }, 2000);
                }
            }
            document.getElementById('cta-button').addEventListener('click', () => handleReward(10));
            document.getElementById('bounce-button').addEventListener('click', () => handleReward(-1));
            document.getElementById('simulate-random-button').addEventListener('click', simulateRandomBehavior);
            document.getElementById('reset-button').addEventListener('click', async () => {
                const confirmed = await showConfirmationModal();
                if (confirmed) {
                    if (simulationInterval) simulateRandomBehavior();
                    agent.reset();
                    showLearning(0, true);
                    setTimeout(startNewSession, 1200);
                }
            });

            // --- GLOBAL CLICK TRACKING ---
            document.querySelectorAll('.global-clickable').forEach(element => {
                element.addEventListener('click', () => {
                    // Give a positive reward to the agent for any meaningful interaction
                    // This will also increment the click counter in the agent's stats
                    handleReward(10);
                });
            });

            setupChart();
            setTheme(savedTheme ? savedTheme === 'dark' : prefersDark);
            themeToggle.addEventListener('click', () => setTheme(!document.documentElement.classList.contains('dark')));
            startNewSession();
        });
    </script>
</body>
</html>

